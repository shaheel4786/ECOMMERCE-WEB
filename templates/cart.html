{% extends 'base.html' %}
{% block content %}
<div class="container mt-5">
    <h2 class="mb-4 text-center">Your Shopping Cart</h2>

    {% if cart_items %}
    <table class="table table-bordered text-center align-middle">
        <thead class="table-dark">
            <tr>
                <th>Image</th>
                <th>Product Name</th>
                <th>Price</th>
                <th>Quantity</th>
                <th>Total</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody>
            {% for item in cart_items %}
            <tr>
                <td><img src="{{ url_for('static', filename='images/' ~ item[3]) }}" width="120"></td>
                <td>{{ item[1] }}</td>
                <td>₹{{ item[2] }}</td>
                <td>
                    <form action="{{ url_for('update_quantity', product_id=item[0]) }}" method="POST" class="d-inline">
                        <button type="button" class="btn btn-outline-secondary btn-sm" onclick="changeQuantity(this, -1)">−</button>
                        <input type="text" name="quantity" value="{{ item[4] }}" size="2" readonly class="text-center border-0 fw-bold">
                        <button type="button" class="btn btn-outline-secondary btn-sm" onclick="changeQuantity(this, 1)">+</button>
                        <button type="submit" class="btn btn-success btn-sm">Update</button>
                    </form>
                </td>
                
                <td>₹{{ item[2] * item[4] }}</td>
                <td class="d-flex flex-column gap-1">
                    <!-- Remove button -->
                    <a href="{{ url_for('remove_from_cart', product_id=item[0]) }}" class="btn btn-danger btn-sm">Remove</a>
                    
                    <!-- Buy Now button for this product -->
                    <a href="{{ url_for('buy_now', product_id=item[0]) }}" 
                       class="btn btn-primary btn-sm text-white"
                       style="
                           background: linear-gradient(135deg, #ff416c 0%, #ff4b2b 100%);
                           border: none;
                           box-shadow: 0 4px 10px rgba(0,0,0,0.2);
                           transition: transform 0.2s;
                       "
                       onmouseover="this.style.transform='scale(1.05)'"
                       onmouseout="this.style.transform='scale(1)'">
                       Buy Now
                    </a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <div class="text-end">
        <h4>Total Amount: ₹{{ total_amount }}</h4>
        <div class="d-flex justify-content-between mt-3">
            <!-- Continue Shopping button on left -->
            <a href="{{ url_for('index') }}" class="btn btn-secondary btn-lg">Continue Shopping</a>

            <!-- Proceed to Checkout button on right -->
            <a href="{{ url_for('checkout_cart') }}" class="btn btn-lg text-white" style="
                background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
                border: none;
                box-shadow: 0 4px 15px rgba(0,0,0,0.2);
                transition: transform 0.2s;
            " onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                Proceed to Checkout
            </a>
        </div>
    </div>

    {% else %}
    <p class="text-center mt-5">Your cart is empty.</p>
    <a href="{{ url_for('index') }}" class="btn btn-secondary btn-lg">Continue Shopping</a>
    {% endif %}
</div>

<script>
function changeQuantity(button, delta) {
    const input = button.parentNode.querySelector('input[name="quantity"]');
    let current = parseInt(input.value);
    if (isNaN(current)) current = 1;
    const newValue = current + delta;
    input.value = newValue < 1 ? 1 : newValue;
}
</script>
{% endblock %}
